#  Clase 6 Enrutamiento en Next.js 13+ (App Router)

Este tutorial explica de manera detallada cómo funciona el enrutamiento en Next.js 13 o superior utilizando el **App Router** (directorio `app`). 

---

## Introducción al App Router

El **App Router**, introducido en Next.js 13, es un sistema de enrutamiento basado en archivos que aprovecha los **React Server Components** para ofrecer un enrutamiento más flexible y potente. A diferencia del **Pages Router** (basado en el directorio `pages`), el App Router utiliza el directorio `app` y permite crear diseños compartidos, manejar rutas dinámicas, rutas paralelas, interceptación de rutas, y más.

El enrutamiento en el App Router se basa en la estructura de carpetas y archivos dentro del directorio `app`. Cada carpeta representa un **segmento de ruta**, y los archivos específicos (como `page.js`) definen la interfaz de usuario para esa ruta.

---

## Conceptos Fundamentales

Antes de profundizar, es importante entender algunos términos clave utilizados en el App Router:

- **Árbol**: Representa la estructura jerárquica de las rutas, similar a un árbol de componentes o carpetas.
- **Segmento de ruta**: Cada carpeta dentro de `app` representa un segmento de la URL (por ejemplo, `/dashboard/settings` tiene los segmentos `dashboard` y `settings`).
- **Raíz**: La carpeta `app` es la raíz del árbol de enrutamiento.
- **Hoja**: El último segmento de una ruta, que suele contener un archivo `page.js` para renderizar la interfaz de usuario.
- **Ruta URL**: La parte de la URL después del dominio, compuesta por segmentos (por ejemplo, `/dashboard/settings`).

El App Router utiliza convenciones específicas de nombres de archivos para definir comportamientos en las rutas, como `page.js` para páginas, `layout.js` para diseños, y otros archivos especiales que veremos más adelante.[](https://runebook.dev/es/docs/nextjs/app/building-your-application/routing)

---

## Estructura Básica del Enrutamiento

El enrutamiento en Next.js 13+ se define automáticamente según la estructura de carpetas dentro del directorio `app`. A continuación, se explica cómo crear rutas básicas.

### Crear una Ruta Básica

Para crear una página, añade un archivo `page.js` dentro del directorio `app`. Este archivo define el contenido principal de la ruta.

Por ejemplo, para crear la página de inicio (`/`):

```bash
app/
└── page.js
```

**Contenido de `app/page.js`**:

```javascript
export default function Home() {
  return (
    <div>
      <h1>Bienvenido a mi aplicación Next.js</h1>
      <p>Esta es la página de inicio.</p>
    </div>
  );
}
```

Este archivo `page.js` se asigna automáticamente a la ruta raíz (`/`). Cuando un usuario visita `http://localhost:3000/`, verá el contenido definido en este archivo.

### Rutas Anidadas

Para crear rutas anidadas, simplemente crea carpetas dentro de `app` y añade un archivo `page.js` en cada una. Por ejemplo, para crear la ruta `/dashboard/settings`:

```bash
app/
└── dashboard/
    └── settings/
        └── page.js
```

**Contenido de `app/dashboard/settings/page.js`**:

```javascript
export default function Settings() {
  return (
    <div>
      <h1>Configuraciones</h1>
      <p>Esta es la página de configuraciones.</p>
    </div>
  );
}
```

Al visitar `http://localhost:3000/dashboard/settings`, se renderizará el contenido de `page.js` en la carpeta `settings`. La estructura de carpetas define automáticamente la jerarquía de la URL.

---

## Diseños (Layouts)

Los **layouts** son componentes que envuelven el contenido de las páginas y permiten compartir elementos comunes, como barras de navegación o pies de página, entre varias rutas. Se definen con un archivo `layout.js`.

### Layout Raíz

El layout raíz es obligatorio y se define en `app/layout.js`. Este layout envuelve todas las páginas de la aplicación.

**Contenido de `app/layout.js`**:

```javascript
export default function RootLayout({ children }) {
  return (
    <html lang="es">
      <body>
        <header>
          <h1>Mi Aplicación</h1>
          <nav>
            <a href="/">Inicio</a> | <a href="/dashboard">Dashboard</a>
          </nav>
        </header>
        <main>{children}</main>
        <footer>
          <p>© 2025 Mi Aplicación</p>
        </footer>
      </body>
    </html>
  );
}
```

- El parámetro `children` contiene el contenido de las páginas hijas (por ejemplo, el contenido de `page.js`).
- Este layout se aplica a todas las rutas de la aplicación.

### Layouts Anidados

Puedes definir layouts anidados para rutas específicas creando un archivo `layout.js` dentro de una carpeta. Por ejemplo, para aplicar un layout solo a las rutas bajo `/dashboard`:

```bash
app/
└── dashboard/
    └── layout.js
    └── page.js
    └── settings/
        └── page.js
```

**Contenido de `app/dashboard/layout.js`**:

```javascript
export default function DashboardLayout({ children }) {
  return (
    <div>
      <h2>Panel de Control</h2>
      <nav>
        <a href="/dashboard">Inicio del Dashboard</a> | <a href="/dashboard/settings">Configuraciones</a>
      </nav>
      <main>{children}</main>
    </div>
  );
}
```

- Este layout envuelve todas las páginas dentro de la carpeta `dashboard` (por ejemplo, `/dashboard` y `/dashboard/settings`).
- El layout raíz (`app/layout.js`) seguirá envolviendo este layout anidado, creando una jerarquía.

---

## Rutas Dinámicas

Las rutas dinámicas permiten manejar URLs con parámetros variables, como `/products/[id]`. En el App Router, las rutas dinámicas se crean usando corchetes (`[]`) en los nombres de las carpetas.

### Ejemplo de Ruta Dinámica

Para crear una ruta dinámica como `/products/[id]`:

```bash
app/
└── products/
    └── [id]/
        └── page.js
```

**Contenido de `app/products/[id]/page.js`**:

```javascript
export default function Product({ params }) {
  return (
    <div>
      <h1>Producto {params.id}</h1>
      <p>Esta es la página del producto con ID: {params.id}</p>
    </div>
  );
}
```

- La carpeta `[id]` indica que el segmento de la URL es dinámico.
- El parámetro `params` contiene los valores dinámicos (por ejemplo, `{ id: "123" }` para la URL `/products/123`).

### Rutas Dinámicas Anidadas

Puedes anidar rutas dinámicas. Por ejemplo, para `/users/[userId]/posts/[postId]`:

```bash
app/
└── users/
    └── [userId]/
        └── posts/
            └── [postId]/
                └── page.js
```

**Contenido de `app/users/[userId]/posts/[postId]/page.js`**:

```javascript
export default function Post({ params }) {
  return (
    <div>
      <h1>Post {params.postId} del usuario {params.userId}</h1>
    </div>
  );
}
```

- Para la URL `/users/1/posts/42`, `params` será `{ userId: "1", postId: "42" }`.

---

## Rutas de Captura Total (Catch-All Routes)

Las rutas de captura total permiten manejar múltiples segmentos de URL. Se definen usando `[...slug]`.

Por ejemplo, para capturar todas las rutas bajo `/blog`:

```bash
app/
└── blog/
    └── [...slug]/
        └── page.js
```

**Contenido de `app/blog/[...slug]/page.js`**:

```javascript
export default function BlogPost({ params }) {
  return (
    <div>
      <h1>Blog</h1>
      <p>Segmentos: {params.slug.join('/')}</p>
    </div>
  );
}
```

- Para la URL `/blog/2023/octubre/mi-post`, `params.slug` será `["2023", "octubre", "mi-post"]`.
- Útil para manejar estructuras de URL profundas o indeterminadas.

---

## Archivos Especiales

El App Router utiliza archivos especiales para definir comportamientos específicos:

- **`page.js`**: Define el contenido principal de una ruta.
- **`layout.js`**: Define un diseño que envuelve las páginas hijas.
- **`loading.js`**: Muestra un estado de carga mientras se renderiza una página.
- **`error.js`**: Maneja errores en una ruta.
- **`not-found.js`**: Muestra una página personalizada para rutas no encontradas (404).

Por ejemplo, para agregar un estado de carga a `/dashboard`:

```bash
app/
└── dashboard/
    └── loading.js
    └── page.js
```

**Contenido de `app/dashboard/loading.js`**:

```javascript
export default function Loading() {
  return <div>Cargando...</div>;
}
```

- Este componente se muestra automáticamente mientras se carga el contenido de `/dashboard`.

---

## Navegación con el Componente Link

El componente `Link` de `next/link` permite realizar navegación del lado del cliente, mejorando la experiencia de usuario al evitar recargas completas.

**Ejemplo de uso**:

```javascript
import Link from 'next/link';

export default function Home() {
  return (
    <div>
      <h1>Inicio</h1>
      <Link href="/dashboard">Ir al Dashboard</Link>
    </div>
  );
}
```

- `Link` precarga automáticamente las rutas visibles en la ventana gráfica en modo producción, mejorando el rendimiento.[](https://www.freecodecamp.org/espanol/news/manual-de-next-js/)

---

## Enrutamiento Programático

Para navegar programáticamente, usa el hook `useRouter` de `next/router`:

```javascript
'use client'; // Indica que es un componente del cliente
import { useRouter } from 'next/router';

export default function Button() {
  const router = useRouter();

  return (
    <button onClick={() => router.push('/dashboard')}>
      Ir al Dashboard
    </button>
  );
}
```

- Asegúrate de usar `'use client'` en componentes que utilicen hooks del lado del cliente.[](https://www.freecodecamp.org/espanol/news/manual-de-next-js/)

---

## Buenas Prácticas

1. **Organización de carpetas**: Usa guiones bajos (`_`) para carpetas que no formen parte del enrutamiento (por ejemplo, `_components` o `_hooks`).[](https://www.reddit.com/r/nextjs/comments/1dc17tv/best_practice_for_folder_structure_in_nextjs_app/?tl=es-es)
2. **Layouts compartidos**: Aprovecha los layouts para mantener consistencia en la UI.
3. **Rutas dinámicas**: Usa nombres descriptivos para parámetros dinámicos (por ejemplo, `[userId]` en lugar de `[id]`).
4. **Optimización**: Habilita el precargado de rutas con `Link` y aprovecha la caché del App Router para mejorar el rendimiento.[](https://bluuweb.dev/09-next/02-fundamentos.html)

---

